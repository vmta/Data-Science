Теперь наша задача перейти
от спрогнозированных скрытых
переменных к прогнозу вероятности.
Соответственно, мы
изменяем наш набор данных:
newdata_pr равняется mutate(newdata_pr).
Точечный прогноз вероятности
равен логистической функции
распределения plogis в точке прогноза
скрытой переменной plogis(fit).
Соответственно, левая граница
доверительного интервала left_ci
confidence interval — это
будет логистическая функция
распределения от точечного
прогноза скрытой переменной
минус 1.96 помножить
на стандартную ошибку.
И правая граница доверительного интервала
right_ci равняется логистическая функция
распределения в точке точечного
прогноза плюс 1.96 умножить
на стандартную ошибку.
Смотрим, что у нас все правильно
написано и запускаем нашу функцию.
Давайте посмотрим снова на набор данных.
И вот здесь у нас уже есть все,
что нам реально интересно:
и возраст — старые объясняющие переменные,
и предсказанная вероятность 0.4,
и доверительный интервал для вероятностей.
Вот, например, для первого наблюдения,
для возраста 5 лет, соответственно,
точечный прогноз вероятностей 0.4,
а 95 %-й доверительный
интервал – от 0.28 до 0.52.
Мы можем визуализировать наши
результаты прогнозирования на графике.
qplot, данные
мы берем из набора данных newdata_pr.
По горизонтали мы на
этот раз отложим возраст,
по вертикали мы отложим
спрогнозированную точечную
вероятность и укажем,
что графиком является простая линия.
Соответственно, мы видим,
что точечный прогноз
вероятности выжить падает
с ростом возраста.
Теперь добавим на наш график границы
95 %-го доверительного интервала.
Пишем плюс geom_ribbon, указываем,
что границами закрашиваемой
области является
ymin нижняя граница от left_ci до
ymax — это правая граница
доверительного интервала.
И давайте закрашивать не
сплошным черным цветом,
это будет очень заметно, давайте
установим некий уровень прозрачности
alpha = 0,2 и посмотрим на наш график.
Вот мы видим теперь не только
точечные прогнозы вероятности выжить,
но и доверительные интервалы.
Причем заметно, что точность
прогнозирования растет с ростом возраста.
Поскольку у нас мало детей и больше
пассажиров в возрасте, то поэтому
доверительный интервал сокращается
с увеличением возраста пассажира,
его ширина сокращается.
Перейдем к сравнению моделей.
Для этого сравним нашу модель с
моделью без финансовых переменных.
Отберем сначала тот же набор данных,
на котором оценивалась первая модель.
По умолчанию R выкидывает
пропущенные наблюдения,
и поэтому первая модель оценивалась не
по всей выборке, а по тем наблюдениям,
где присутствуют переменные: пол,
тариф, класс пассажира и его возраст.
Отберем выборку t2 равняется,
отберем нужные переменные select(t) пол,
возраст, класс пассажира,
выжил он или не выжил, тариф,
и удалим из данной выборки
пропущенные значения.
После этого на этой выборке,
на которой оценивалась первая модель,
оценим вторую модель
m_logit2 равняется glm.
Данные мы берем из набора данных t2,
формула будет более простой,
мы пытаемся предсказать вероятность
выживет или не выживет только с помощью
физической характеристики человека,
а именно пол и возраст.
И точно так же,
как и ранее указываем семейство моделей
биноминальное, family равняется binomial,
и уравнение связи логит-.
И указываем,
что нам потребуются, возможно,
в дальнейшем иксы для
оценивания предельных эффектов.
Теперь, когда у нас оценена
вторая модель более простая,
мы можем их сравнить с помощью теста
отношения правдоподобия lr-теста.
lrtest модель logit и модель logit2.
Мы видим результаты теста,
тест нам говорит,
что гипотеза отвергается,
потому что p-value очень мало.
То есть гипотеза о том, что финансовые
переменные не оказывают влияния
на вероятность выжить, отвергается.

