Второй этап- оценивание моделей.
Оценивание моделей.
Для начала оценим логит-модель.
m_logit равняется.
Логит-модель относится к классу
обобщенных линейных моделей.
То есть R позволяет оценивать
не только логит- и пробит-модели,
но и гораздо более широкий класс моделей,
поэтому отсюда сокращение GLM
— generalized linear models.
Данные мы берем,
как всегда, из таблички T.
Формула, по которой мы
оцениваем переменную survived,
мы пытаемся предсказать с помощью пола,
возраста, класса,
которым ехал пассажир, и тарифа.
Здесь надо указать теперь,
что мы имеем в виду логит--модель.
Logit-модель относится к
классу биномиальных моделей.
Фамилия = binomial.
И связующая функция
называется логит--функцией.
И также нам надо указать, чтобы
компьютер сохранил исходные регрессоры
в оцененной модели, это нам понадобится
для оценки предельных эффектов.
Все готово, мы оценили логит-модель.
Аналогичным кодом сразу
давайте оценим пробит-модель.
Нам требуется небольшая корректировка,
m_probit равняется,
все параметры точно такие же,
кроме связующей функции.
Связующая функция — probit.
Выполняем эту команду и смотрим на
результаты оценивая, summary логит-модели.
Что мы видим в отчете по логит-модели?
Мы видим оценки коэффициентов,
коэффициент при возрасте: -0.03.
Коэффициент при дамми-переменной,
отвечающей за пассажиров второго класса,
коэффициент при дамми-переменной,
отвечающей за пассажиров третьего класса,
коэффициент при тарифе.
Уже видно,
что знаки оправдывают наши ожидания.
Например, при возрасте
коэффициент отрицательный,
а при тарифе коэффициент положительный.
То есть тариф, то есть стоимость билета
положительно влияла на вероятность выжить.
Аналогично можно посмотреть
отчет краткий по пробит-модели.
Мы говорили, что логит-модель и
probit-модель по сути, по вопросу
прогнозирования отличаются не существенно,
и только в силу масштабирования скрытой
переменной коэффициенты в логит-модели
отличаются от коэффициентов в
probit-модели примерно в 1.6 раза.
И это соотношение заметно.
Например, коэффициент при
возрасте в probit-модели: -0,019,
в то время как коэффициент при
возрасте в логит--модели: -0.034.
Выпишем и проинтерпретируем
уравнения полученной регрессии.
У нас логит--модель, поэтому мы моделируем
логорифм отношения шансов,
то есть логарифм дроби, вероятность того,
что y = 1, деленное на вероятность того,
что y = 0.
И он равен.
Естественно, идет речь об оценках,
поэтому мы пишем крышечку над P.
Теперь проинтерпретируем
полученное уравнение регрессии,
отдельные коэффициенты.
Рассмотрим коэффициент перед
непрерывной переменной — возраст.
И перед переменной дискретной — пол.
Sex male, которая равна 1, если пассажир
— мужчина, и 0, если пассажир — женщина.
Коэффициент β₂ с крышкой при age
= -0,03 Это означает,
что с ростом переменной «возраст» на 1,
то есть на 1 год (она измеряется в годах)
отношение шансов P с крышечкой 
(y = 1) делить на P с крышечкой (y = 0),
это отношение шансов падает,
раз коэффициент отрицательный,
и падает оно на… умножаем на 100,
получаем процентное падение на 3%.
Аналогично можно проинтерпретировать
коэффициент при любой
непрерывной переменной, например,
при переменной «тариф».
β с крышкой fare = 0.0003,
значит с ростом
тарифа на одну единицу (он
измерялся в фунтах) логарифмическое
отношение шансов,
то есть отношение вероятности того,
что y = 1 к вероятности того, что y = 0,
растет на 0,0003, а само отношение
шансов растет на 0.03%.
Теперь мы этот кусочек стираем,
и здесь я интерпретирую
дискретный коэффициент,
поскольку он тяжелее интерпретируется.
Теперь проинтерпретируем
качественный коэффициент «пол»,
который принимает значения: 0
базовой категории для женщин и 1,
переменная sex male = 1, для мужчин.
Здесь величина коэффициента большая,
поэтому интерпретировать
производную очень плохо,
лучше посчитать изменения именно
аккуратно, с учетом экспоненты.
Соответственно, что мы получим?
Если логарифм отношения шансов,
если логарифм отношения шансов,
в него входит в качестве составной
части: -2,49 умножить на дамми-переменную,
обозначающую пол участника, то это
означает, что само отношение шансов,
вероятность того, что y = 1 делить
на вероятность того, что y = 0,
это есть экспонента,
от -2,49, помножить на дамми-переменную,
обозначающую пол участника,
помножить на остальные составляющие.
Соответственно, при изменении,
при сравнении двух пассажиров,
одного с женским полом,
женщины и мужчины, мы получим,
что отношение шансов меняется
в экспоненту от -2,49 раз.
То есть, если переменная sex
male меняется от 0 до 1,
то есть мы сравниваем двух пассажиров
— женщину и мужчину, то получается,
что это отношение шансов домножается,
вернее,
делится на экспоненту от 2.49,
это примерно 12.
То есть мы можем сказать,
что отношение шансов,
шансы у женщин примерно в 12 раз больше,
чем у мужчин.
Раз коэффициент отрицательный, значит при
переходе от 0 к 1 отношение шансов падает.
И отношение шансов падает
примерно в 12 раз.
Мы можем посмотреть на ковариационную
матрицу оцененных коэффициентов.
Ковариационная матрица.
А именно
variance covariance
matrix от модели логит.
Соответственно, например,
эта матрица показывает,
что оценка дисперсии
свободного члена равна 0.14.
Например, оценка ковариации
между коэффициентом
при поле и свободным членом
равна: -2.6 на 10 в -2-ой.
Как мы уже говорили, к сожалению,
коэффициенты в логит- и пробит-
моделях интерпретируются плохо.
Гораздо проще интерпретировать
спрогнозированные вероятности или
предельные эффекты.
На сколько увеличивается вероятность
выжить при росте одной или другой
переменной на 1.
Давайте перейдем к задаче прогнозирования
и задаче оценки предельных эффектов.
Для начала мы
создадим новый искусственный набор данных,
для которого и будем прогнозировать.
Создадим новый набор данных — new data.
В новых набор данных, это у нас будет
data frame, табличка с данными,
Скажем, мы спрогнозируем
вероятность выжить для мужчин,
которые едут 2-м классом
всех возможных возрастов.
Соответственно, мы установим,
что age меняется.
Последовательность от,
скажем, 5-ти до 100 лет.
И рассмотрим 100 разных
возрастов от 5 до 100.
Укажем, что пол нас,
нас интересуют мужчины.
Укажем класс 2-ой.
И надо указать еще тариф,
ну давайте возьмем тариф
равный 100.
Выполняем нашу команду.
Это команда нам создала
новый набор данных.
Можем для удобства,
чтобы его легче было представлять,
просто посмотрим,
что находится в наборе new data.
В наборе new data есть
переменная «возраст»,
меняющийся потихоньку от 5 до 100,
переменная «пол»,
которая равна мужчине, переменная
«класс» 2-ой, переменная «тариф» 100.
Соответственно, для всех этих наблюдений
мы сейчас построим прогнозы по модели
логит-.
Строим прогнозы для этого набора данных.
Прогнозы по логит-модели
= команда predict,
мы используем логит-модель,
m_logIt, используем набор
данных new data и, поскольку
мы хотим строить не только точечные
прогнозы, но и доверительные интервалы,
то указываем, что нам нужны
стандартные ошибки, se = TRUE.
Замечательно, у нас вылезла ошибка,
когда у вас вылезает ошибка,
не пугайтесь, прочитайте и исправьте.
Тут написано, что не найдет fare.
Ну, соответственно, это я просто
опечатался и назвал «тариф» по-русски,
когда надо было назвать
'fare' по-английски.
Исправляем и снова запускаем
наши несколько команд.
Теперь прогнозы прекрасно построились.
Давайте объединим наш набор new data
и «прогнозы» в один и посмотрим,
что у нас получится.
New data с прогнозами, поскольку мы
объединяем столбики, то эта команда cbind,
и мы объединяем набор данных new data и
прогнозы, построенные по логит-модели.
Давайте посмотрим, что у нас получилось.
Видна переменная: возраст,
пол, класс пассажира,
тариф fare, fit — это предсказанная,
скрытая переменная y со звездочкой,
и se.fit — это стандартная
ошибка данной переменной.
Residual.
scale — это какой-то вспомогательный…
единичка, она нам не понадобится.

