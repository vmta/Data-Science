1
00:00:13,520 --> 00:00:17,855
Когда вы построили много регрессий,

2
00:00:17,855 --> 00:00:22,190
проверили много гипотез и
нарисовали кучу графиков,

3
00:00:22,190 --> 00:00:27,700
и нашли кое-что интересное, вы можете
донести свои результаты до других людей.

4
00:00:27,700 --> 00:00:33,342
Ну, соответственно, обычно используют
там Tex или Word, и, соответственно,

5
00:00:33,342 --> 00:00:38,620
вы берете ваши готовые
картинки и вставляете их,

6
00:00:38,620 --> 00:00:44,490
соответственно, в вашу работу.

7
00:00:44,490 --> 00:00:48,147
Ну, оказывается, это можно сделать
автоматически с помощью грамотного

8
00:00:48,147 --> 00:00:52,681
программирования так, что вам не придется
практически ничего менять в вашей работе.

9
00:00:52,681 --> 00:00:56,617
Если вдруг у вас появятся новые
наблюдения или вы обнаружите ошибку,

10
00:00:56,617 --> 00:00:58,574
все может пересчитаться само.

11
00:00:58,574 --> 00:01:00,313
Поэтому мы сейчас покажем,

12
00:01:00,313 --> 00:01:04,814
как комбинировать человекочитабельный
текст с инструкциями компьютера.

13
00:01:04,814 --> 00:01:07,540
Это называется грамотное программирование.

14
00:01:07,540 --> 00:01:13,190
Нажимаем вот здесь + и выбираем не
R Script на этот раз, а R Markdown.

15
00:01:13,190 --> 00:01:17,243
Здесь по умолчанию предлагается вариант,

16
00:01:17,243 --> 00:01:22,332
что мы хотим видеть на выходе:
HTML-файл для публикации в сети,

17
00:01:22,332 --> 00:01:26,066
PDF, соответственно, здесь будет
использоваться LaTex, или Word.

18
00:01:26,066 --> 00:01:29,430
Ну, давайте сначала
начнем с варианта с Word.

19
00:01:29,430 --> 00:01:37,630
Озаглавим нашу работу «Нано исследование».

20
00:01:37,630 --> 00:01:43,350
Здесь вот обязательно нужно пометить,
что язык у нас русский.

21
00:01:43,350 --> 00:01:46,788
А это все, вот мы пример этот удалим.

22
00:01:46,788 --> 00:01:50,130
Мы будем писать свое исследование.

23
00:01:50,130 --> 00:01:51,586
Поехали!

24
00:01:51,586 --> 00:01:57,163
В этом исследовании мы рассмотрим

25
00:01:57,163 --> 00:02:04,510
цены на квартиры в Москве.

26
00:02:04,510 --> 00:02:06,447
Теперь вставляем блок кода,

27
00:02:06,447 --> 00:02:10,400
который будет загружать наши
данные и необходимые пакеты.

28
00:02:10,400 --> 00:02:14,209
Вот здесь вот есть Code – Insert Chunk.

29
00:02:14,209 --> 00:02:16,570
Chunk – это кусок кода.

30
00:02:16,570 --> 00:02:19,570
Вот тут Ctrl + Alt + I в Windows.

31
00:02:19,570 --> 00:02:23,222
Ctrl + Alt + I нажимаем,
и появляется серенький блок кода.

32
00:02:23,222 --> 00:02:27,520
Это уже не человекочитабельная команда,
а команда, адресованная R.

33
00:02:27,520 --> 00:02:28,892
Ну, мы их скопируем.

34
00:02:28,892 --> 00:02:31,940
У нас вот здесь вот вначале
подгружались пакеты.

35
00:02:31,940 --> 00:02:39,240
Скопируем это вот,
это подгружаются пакеты.

36
00:02:39,240 --> 00:02:42,070
Теперь загрузим наши данные.

37
00:02:42,070 --> 00:02:48,560
Так.

38
00:02:48,560 --> 00:02:53,336
Теперь мы можем сказать, что, скажем,

39
00:02:53,336 --> 00:02:59,118
в нашем наборе данных,
и маленький блок, адресованный R.

40
00:02:59,118 --> 00:03:04,060
Кавычка, одинарная кавычка, но она,
правда, скошена в другую сторону.

41
00:03:04,060 --> 00:03:07,730
Эта кавычка, как правило,
находится на клавиатуре над буквой «ё».

42
00:03:07,730 --> 00:03:12,240
Кавычка в обратную сторону
(«`») команда для r,

43
00:03:12,240 --> 00:03:15,670
количество строк в табличке f.

44
00:03:15,670 --> 00:03:23,200
В нашем наборе данных команда `r nrow(f)`,
то есть nrow(f) – это обычная команда r,

45
00:03:23,200 --> 00:03:31,180
наблюдений.

46
00:03:31,180 --> 00:03:37,569
Скажем, средняя цена квартиры равна,

47
00:03:37,569 --> 00:03:42,272
и снова маленький блок
`r mean(f$price)` `r

48
00:03:42,272 --> 00:03:48,588
mean(f$price)` тысяч

49
00:03:48,588 --> 00:03:52,330
y.e.

50
00:03:52,330 --> 00:03:56,690
Теперь давайте построим
какой-нибудь график.

51
00:03:56,690 --> 00:04:01,250
Красивый график,

52
00:04:01,250 --> 00:04:06,021
ну, выбираем код для красивого графика,

53
00:04:06,021 --> 00:04:10,910
снова блок кода для r.

54
00:04:10,910 --> 00:04:14,980
Вот несколькими кавычками, ``` {r},

55
00:04:14,980 --> 00:04:19,050
``` – это блок из нескольких строчек,
а если это одна короткая команда,

56
00:04:19,050 --> 00:04:22,890
а не много строчек, то тогда мы используем
такой, более простой синтаксис.

57
00:04:22,890 --> 00:04:27,111
И отсюда мы возьмем, соответственно,
что нам надо сделать.

58
00:04:27,111 --> 00:04:32,850
Нам надо преобразовать типы данных,

59
00:04:32,850 --> 00:04:36,990
сказать, что эти переменные
факторные: walk, brick, floor и code,

60
00:04:36,990 --> 00:04:39,984
и дальше мы можем построить
какой-нибудь график.

61
00:04:39,984 --> 00:04:41,760
Например, возьмем вот этот.

62
00:04:41,760 --> 00:04:46,890
Дальше оценим,

63
00:04:46,890 --> 00:04:53,520
оценим и сравним три модели.

64
00:04:53,520 --> 00:04:58,930
Вставляем снова серенький блок кода,

65
00:04:58,930 --> 00:05:03,220
вот у нас три модели оцениваются,

66
00:05:03,220 --> 00:05:09,240
и вот здесь вот они

67
00:05:09,240 --> 00:05:14,160
сравниваются в одной табличке.

68
00:05:14,160 --> 00:05:18,832
И соответственно, можем тут написать,

69
00:05:18,832 --> 00:05:24,750
что у нас лучше оказалась модель 2.

70
00:05:24,750 --> 00:05:29,584
Теперь сохраняем этот файл, пусть это

71
00:05:29,584 --> 00:05:36,520
будет nano_research.Rmd,

72
00:05:36,520 --> 00:05:42,940
это означает комбинацию R Markdown,
мы сохраняем, и, соответственно,

73
00:05:42,940 --> 00:05:47,491
теперь, если мы все правильно перенесли,
эти команды исполняются, в принципе,

74
00:05:47,491 --> 00:05:50,430
их точно также можно протестировать,
понажимав Ctrl + Enter,

75
00:05:50,430 --> 00:05:56,350
то мы можем создать готовый,
в данном случае, «вордовский» документ.

76
00:05:56,350 --> 00:06:00,388
Ну, тут надо чуть-чуть подождать,
потому что компьютер что сделает?

77
00:06:00,388 --> 00:06:03,330
Он выкусит команды,
адресованные r, исполнит их,

78
00:06:03,330 --> 00:06:06,830
после этого соединит в один
файл с расширением Markdown,

79
00:06:06,830 --> 00:06:11,430
а потом преобразует файл с
расширением Markdown в Word.

80
00:06:11,430 --> 00:06:12,422
Ну, что мы тут видим?

81
00:06:12,422 --> 00:06:15,780
Вот оно, наше «Нано исследование»,
это обычный «вордовский» файл.

82
00:06:15,780 --> 00:06:20,300
Тут автоматом появились графики.

83
00:06:20,300 --> 00:06:23,195
Вот здесь вот, правда,
куча информации о загрузке пакетов,

84
00:06:23,195 --> 00:06:26,430
но это мы сейчас уберем, конечно,
в исследовании все это скрывают,

85
00:06:26,430 --> 00:06:31,100
а вот здесь уже вот
автоматом все посчитано.

86
00:06:31,100 --> 00:06:36,550
Все, значит,
циферки вставлены вместо команд r.

87
00:06:36,550 --> 00:06:40,327
Вот он, график наш,
вставлен, вот она, табличка.

88
00:06:40,327 --> 00:06:45,495
Она, правда, пока не очень красивая, но
это уже практически готовое исследование.

89
00:06:45,495 --> 00:06:48,070
Что нам осталось сделать,
чтобы оно было красивым?

90
00:06:48,070 --> 00:06:52,233
Ну, во-первых, вот эту системную
информацию о том, что вот, предупреждение,

91
00:06:52,233 --> 00:06:56,852
загружается такой-то пакет, он был создан
под версией 3.1.2, у вас более старая,

92
00:06:56,852 --> 00:06:58,370
это нам, конечно, не нужно.

93
00:06:58,370 --> 00:07:04,204
Поэтому мы результаты этого блока,

94
00:07:04,204 --> 00:07:09,674
который надстроечный, вначале обычно
любого проекта идет какой-то блок,

95
00:07:09,674 --> 00:07:14,577
который загружает данные, загружает пакеты
и ничего содержательного не выводит,

96
00:07:14,577 --> 00:07:16,920
естественно, такой блок надо скрыть.

97
00:07:16,920 --> 00:07:21,670
И мы покажем, напишем тут опцию ```{r,
include=FALSE}, то есть этот

98
00:07:21,670 --> 00:07:26,710
блок команд будет исполняться,
но результаты, никто ничего не увидит.

99
00:07:26,710 --> 00:07:33,130
Давайте посмотрим, что получится.

100
00:07:33,130 --> 00:07:37,407
Ну, опять же, надо чуть-чуть подождать,

101
00:07:37,407 --> 00:07:43,079
и мы получаем на выходе «вордовский»

102
00:07:43,079 --> 00:07:49,686
файл с уже ну,

103
00:07:49,686 --> 00:07:53,920
практически готовым текстом.

104
00:07:53,920 --> 00:08:00,137
Чтобы полностью облагородить наше «Нано
исследование», мы скроем команды r.

105
00:08:00,137 --> 00:08:04,010
Соответственно, вот здесь
вот библиотека knitr,

106
00:08:04,010 --> 00:08:09,125
которая на самом деле реализует
взаимодействие между r и преобразует

107
00:08:09,125 --> 00:08:15,680
все в результате в Markdown,
а потом в Word, здесь мы укажем опцию.

108
00:08:15,680 --> 00:08:21,180
Давайте подгрузим библиотеку knitr,
нажмем здесь Ctrl + Enter,

109
00:08:21,180 --> 00:08:27,820
opts_chunk выберем, укажем,
что нам их надо установить,

110
00:08:27,820 --> 00:08:33,240
и установим опции, что нам не надо
показывать код r, то есть echo=FALSE,

111
00:08:33,240 --> 00:08:38,397
и всякие системные сообщения команд о том,
что что-то

112
00:08:38,397 --> 00:08:41,940
там произошло или что-то не произошло,
мы тоже показывать не будем, скроем их.

113
00:08:41,940 --> 00:08:46,748
Сохраним наш .Rmd-файл и снова попробуем

114
00:08:46,748 --> 00:08:51,175
посмотреть, что у нас получится на выходе.

115
00:08:51,175 --> 00:08:56,650
Соответственно, сейчас эти опции о том,
что надо скрывать код,

116
00:08:56,650 --> 00:09:00,300
приведут к тому, что код виден не будет,

117
00:09:00,300 --> 00:09:08,066
и мы получим практически в
чистом виде исследование.

118
00:09:08,066 --> 00:09:10,840
Вот эти все числа
рассчитаны автоматически,

119
00:09:10,840 --> 00:09:13,392
мы их не набирали руками,
а получили результат.

120
00:09:13,392 --> 00:09:15,947
Единственное, что мешает
совсем красивому исследованию,

121
00:09:15,947 --> 00:09:17,370
– это не очень удачная табличка.

122
00:09:17,370 --> 00:09:21,152
Она, конечно, совершенно понятна,
но что-то тут, какой-то Calls,

123
00:09:21,152 --> 00:09:26,122
что-то вот тут какие-то подчеркивания
и диезы двойные, что не очень красиво.

124
00:09:26,122 --> 00:09:30,329
Соответственно, последний шаг
облагораживания – это использование

125
00:09:30,329 --> 00:09:34,010
специального формата таблиц,
который подходит под Word или под LaTex.

126
00:09:34,010 --> 00:09:36,188
Что мы сделаем?

127
00:09:36,188 --> 00:09:40,952
Мы воспользуемся функцией,
которая не просто вот

128
00:09:40,952 --> 00:09:45,700
такие стандартные таблички
моноширинным шрифтом выводит,

129
00:09:45,700 --> 00:09:49,120
а мы немножко тут видоизменим настройки.

130
00:09:49,120 --> 00:09:50,740
Мы укажем две вещи.

131
00:09:50,740 --> 00:09:55,795
Первое, мы укажем здесь опцию,
что результат команд не

132
00:09:55,795 --> 00:10:00,662
надо обрабатывать стандартным способом,
не надо справа ставить диезы, закрашивать

133
00:10:00,662 --> 00:10:05,610
его в серый цвет, то есть укажем,
что результаты as is, «такие как есть».

134
00:10:05,610 --> 00:10:09,925
И дальше мы воспользуемся командой,
которая специальным образом

135
00:10:09,925 --> 00:10:14,240
обрабатывает таблицы так,
чтобы их потом понимали и Word, и LaTex.

136
00:10:14,240 --> 00:10:20,080
Мы здесь укажем pander(mtable),
то есть 2 вида изменения,

137
00:10:20,080 --> 00:10:24,820
и посмотрим,
что у нас получится на этот раз.

138
00:10:30,745 --> 00:10:32,099
И, соответственно,

139
00:10:32,099 --> 00:10:36,670
на этот раз у нас есть текст исследования
с графиком и с красивой табличкой.

140
00:10:36,670 --> 00:10:40,710
Помимо возможности получения
результата готового в формате Word,

141
00:10:40,710 --> 00:10:46,500
мы можем также получить готовый результат
в Texе и, следовательно, в PDF.

142
00:10:46,500 --> 00:10:49,461
Для этого мы просто выбираем другую опцию,

143
00:10:49,461 --> 00:10:53,476
вместо Knit Word указываем Knit PDF,
ждем некоторое время.

144
00:10:53,476 --> 00:10:56,520
Происходит за кадром
сложная цепочка операций.

145
00:10:56,520 --> 00:11:02,633
r оценивает модели, строит графики, из r
Markdown'a получается просто Markdown,

146
00:11:02,633 --> 00:11:05,633
потом Markdown превращается
в «теховский» файл,

147
00:11:05,633 --> 00:11:08,470
и потом уже «теховский»
файл превращается в PDF.

148
00:11:08,470 --> 00:11:11,542
Здесь PDF, красивые таблицы, графики.

149
00:11:11,542 --> 00:11:16,291
Конечно, для отсылки в настоящий
журнал или презентации, нам не

150
00:11:16,291 --> 00:11:20,850
хватает здесь более аккуратных надписей,
названий строк, названий столбцов,

151
00:11:20,850 --> 00:11:24,290
подписей осей и графиков,
но тем не менее, это уже готовый PDF,

152
00:11:24,290 --> 00:11:29,440
который можно доработать до
совсем идеального состояния.

153
00:11:29,440 --> 00:11:34,080
Если вам все-таки по каким-то причинам
нужно увидеть сам «теховский» файл,

154
00:11:34,080 --> 00:11:37,500
который был создан за кадром,
то вот здесь вот в опциях,

155
00:11:37,500 --> 00:11:42,503
нажав на шестеренку и выбрав Advanced,
мы можем поставить опцию Keep tex

156
00:11:42,503 --> 00:11:47,272
source file used to produce PDF,
и, соответственно,

157
00:11:47,272 --> 00:11:53,110
тогда у нас будут сохранены
и «теховский» исходники.

