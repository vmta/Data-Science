1
00:00:12,715 --> 00:00:17,131
Проверим предварительно наличие

2
00:00:17,131 --> 00:00:23,769
гетероскедастичности графически
с помощью остатков.

3
00:00:23,769 --> 00:00:29,274
Во-первых, добавим в нашу
табличку с данными h остатки,

4
00:00:29,274 --> 00:00:32,170
полученные при оценивании модели,

5
00:00:32,170 --> 00:00:37,188
то есть h = augment, с помощью модели,

6
00:00:37,188 --> 00:00:42,300
которая так и называется
model и к набору данных h.

7
00:00:42,300 --> 00:00:46,188
Давайте посмотрим, что у нас получилось,

8
00:00:46,188 --> 00:00:50,006
что изменилось в наборе h glimpse(h).

9
00:00:50,006 --> 00:00:55,051
И здесь видно,
что помимо исходных переменных цена,

10
00:00:55,051 --> 00:00:59,334
общая площадь, жилая площадь,
расстояние до центра и так далее,

11
00:00:59,334 --> 00:01:03,760
появились новые переменные,
которые родились после оценивания модели,

12
00:01:03,760 --> 00:01:08,381
а именно, соответственно, нас будет
интересовать эта переменная .resid — это

13
00:01:08,381 --> 00:01:12,060
новая переменная,
которая равна соответствующему остатку,

14
00:01:12,060 --> 00:01:17,910
также интересна переменная .fitted — это
прогнозное значение стоимости квартир.

15
00:01:17,910 --> 00:01:22,420
И мы построим график,

16
00:01:22,420 --> 00:01:26,251
как зависит от регрессора размер остатка.

17
00:01:26,251 --> 00:01:31,620
То есть мы построим график,
используя табличку h с новыми добавленными

18
00:01:31,620 --> 00:01:37,135
переменными, где по горизонтали отложим
объясняющую переменную — в нашем

19
00:01:37,135 --> 00:01:42,300
случае это общая площадь,
а по вертикали отложим,

20
00:01:42,300 --> 00:01:48,590
соответственно, абсолютное значение
остатка модуль остатка abs(.resid).

21
00:01:48,590 --> 00:01:52,007
На этом графике мы также видим,

22
00:01:52,007 --> 00:01:56,930
что с ростом общей площади, с ростом

23
00:01:56,930 --> 00:02:01,470
total span меняется разброс остатков,
меняется разброс ошибок прогнозов.

24
00:02:01,470 --> 00:02:04,986
Когда total span (общая
площадь) маленькая,

25
00:02:04,986 --> 00:02:10,044
то разброс ошибок прогнозов небольшой,
когда total span большая — разброс

26
00:02:10,044 --> 00:02:15,331
ошибок прогнозов большой, что еще раз
подтверждает нам гетероскедастичность.

27
00:02:15,331 --> 00:02:20,015
Давайте попробуем, соответственно,
вместо ковариационной матрицы,

28
00:02:20,015 --> 00:02:23,288
оцениваемой стандартными
формулами по умолчанию,

29
00:02:23,288 --> 00:02:26,470
получить оценки устойчивой
гетероскедастичности.

30
00:02:26,470 --> 00:02:30,286
Соответственно, мы пишем
variance-covariance matrix, HC

31
00:02:30,286 --> 00:02:37,448
heteroscedasticity consistent (устойчивой
гетероскедастичности) для модели model.

32
00:02:37,448 --> 00:02:42,290
Это немножко другая матрица,
ее можно сравнить легко с той, что была.

33
00:02:42,290 --> 00:02:47,119
Давайте для удобства разместим их
рядом и посмотрим как изменились

34
00:02:47,119 --> 00:02:49,340
оценки стандартных ошибок.

35
00:02:49,340 --> 00:02:54,092
И видно, что оценки стандартных
ошибок существенно выросли.

36
00:02:54,092 --> 00:02:57,530
Например, при использовании
неправильной формулы,

37
00:02:57,530 --> 00:03:01,100
которая верна для случая
гомоскедастичных ошибок,

38
00:03:01,100 --> 00:03:07,080
оценка дисперсии коэффициента
при общей площади равна 0,0024,

39
00:03:07,080 --> 00:03:11,260
в то время как при использовании
корректных формул,

40
00:03:11,260 --> 00:03:13,818
которые позволяют работать
с гетероскедастичностью,

41
00:03:13,818 --> 00:03:19,670
та же самая оценка дисперсии равна
0,013 — что на порядок больше.

42
00:03:19,670 --> 00:03:26,170
Мы обсуждали на лекции,
что существует несколько способов

43
00:03:26,170 --> 00:03:32,073
корректировки оценок для малых выборок,
которые асимптотически эквивалентны,

44
00:03:32,073 --> 00:03:35,523
но на малых выборках они могут
дать немножко разные результаты.

45
00:03:35,523 --> 00:03:39,387
Команда vcov HC(model) позволяет

46
00:03:39,387 --> 00:03:44,534
использовать все популярные
типы корректировок, ну,

47
00:03:44,534 --> 00:03:49,784
например корректировка HC2,
которая нам выдаст чуть-чуть другие

48
00:03:49,784 --> 00:03:54,992
оценки дисперсий оцененных коэффициентов,
но, тем не менее, они похожи на те,

49
00:03:54,992 --> 00:04:00,990
что используются в самом
удачном алгоритме HC3.

50
00:04:00,990 --> 00:04:07,930
Протестируем гипотезы

51
00:04:07,930 --> 00:04:14,226
о равенстве нулю коэффициентов с
использованием верных стандартных ошибок.

52
00:04:14,226 --> 00:04:19,852
То есть проведем coeftest — тест
на коэффициенты для модели,

53
00:04:19,852 --> 00:04:25,161
но теперь будем использовать правильную,
подходящую для данного случая

54
00:04:25,161 --> 00:04:31,250
ковариационную матрицу,
а именно vcov HC для данной модели.

55
00:04:31,250 --> 00:04:35,754
К счастью, мы видим,
что в данной ситуации,

56
00:04:35,754 --> 00:04:40,557
несмотря на то, что поменялись значения
t-statistic, давайте мы увидим,

57
00:04:40,557 --> 00:04:45,608
что они действительно поменялись,
возьмем рядом для сравнения покажем

58
00:04:45,608 --> 00:04:52,540
старый тест с использованием неверных
оценок ковариаций и стандартных ошибок.

59
00:04:52,540 --> 00:04:57,787
Вот видно, что оценки коэффициентов
ни на сколько не поменялись,

60
00:04:57,787 --> 00:05:01,480
абсолютно те же самые оценки
коэффициентов β с крышкой,

61
00:05:01,480 --> 00:05:05,111
однако стандартные ошибки
существенно меняются.

62
00:05:05,111 --> 00:05:08,420
Здесь с 3,7 до 7,8 — примерно в два раза,

63
00:05:08,420 --> 00:05:13,800
и здесь от 0,049 до 0,12.

64
00:05:13,800 --> 00:05:17,209
Соответственно, изменения
очень существенные.

65
00:05:17,209 --> 00:05:21,284
Но, тем не менее, коэффициенты
остаются значимы что в первом,

66
00:05:21,284 --> 00:05:22,623
что во втором случае.

67
00:05:22,623 --> 00:05:24,960
Этот вывод, к счастью, не меняется.

68
00:05:24,960 --> 00:05:27,934
Теперь построим,
не только проверим гипотезы,

69
00:05:27,934 --> 00:05:33,033
но и построим доверительные интервалы
устойчивой гетероскедастичности.

70
00:05:33,033 --> 00:05:38,263
Поскольку асимптотически эти t-статистики
имеют нормальное распределение,

71
00:05:38,263 --> 00:05:42,132
то мы можем использовать
соответствующие квантили,

72
00:05:42,132 --> 00:05:47,612
отступить от оцененного коэффициента
2,59 влево и вправо на две

73
00:05:47,612 --> 00:05:52,750
стандартных ошибки и получить
95 % доверительный интервал.

74
00:05:52,750 --> 00:05:56,006
Давайте попробуем это сделать.

75
00:05:56,006 --> 00:06:02,740
Помещаем результат тестирования
гипотез в отдельную табличку,

76
00:06:02,740 --> 00:06:07,090
давайте назовем ее conftable.

77
00:06:07,090 --> 00:06:11,950
Соответственно, это результат
предыдущей команды,

78
00:06:11,950 --> 00:06:18,909
и после этого из этой
таблички conftable нам,

79
00:06:18,909 --> 00:06:22,691
собственно, нужны только оценки
коэффициентов и стандартные ошибки.

80
00:06:22,691 --> 00:06:27,063
А дальше мы прибавим к оценке коэффициента
две стандартных ошибки и вычтем две

81
00:06:27,063 --> 00:06:28,380
стандартных ошибки.

82
00:06:28,380 --> 00:06:32,658
Соответственно, табличка для
доверительного интервала,

83
00:06:32,658 --> 00:06:36,407
это будет data.frame.

84
00:06:36,407 --> 00:06:41,875
Мы берем оценку estimate —

85
00:06:41,875 --> 00:06:47,880
это будет из нашей таблички
conftable первый столбик,

86
00:06:47,880 --> 00:06:52,851
а, соответственно,
стандартная ошибка устойчивой

87
00:06:52,851 --> 00:06:57,039
гетероскедастичности, давайте пометим,
что это,

88
00:06:57,039 --> 00:07:02,115
назовем ее se_hc heteroscedasticity
consistant — это будет,

89
00:07:02,115 --> 00:07:08,820
соответственно, второй столбик
нашей таблички conftable.

90
00:07:13,535 --> 00:07:18,250
И, соответственно, взяли из нашей
таблички только то, что нам интересно,

91
00:07:18,250 --> 00:07:22,886
а теперь изменим нашу
табличку mutate (ci),

92
00:07:22,886 --> 00:07:26,947
дописав в нее левую границу
доверительного интервала

93
00:07:26,947 --> 00:07:31,810
left_ ci,

94
00:07:31,810 --> 00:07:35,276
считается по формуле, соответственно,

95
00:07:35,276 --> 00:07:40,435
estimate минус

96
00:07:40,435 --> 00:07:44,820
1,96 помножить на стандартную ошибку.

97
00:07:44,820 --> 00:07:49,850
Правая граница доверительного интервала

98
00:07:49,850 --> 00:07:55,686
right_ci считается по формуле: оценка плюс

99
00:07:55,686 --> 00:08:03,480
1,96 умножить на стандартную ошибку
в условиях гетероскедастичности.

100
00:08:07,700 --> 00:08:14,231
Посмотрим на нашу табличку и
получаем доверительные интервалы.

101
00:08:14,231 --> 00:08:20,705
Соответственно, доверительный интервал
для свободного члена от –77 до –46 и

102
00:08:20,705 --> 00:08:26,133
доверительный интервал для коэффициента
при общей площади, то есть для

103
00:08:26,133 --> 00:08:31,280
эффекта насколько увеличится цена при
увеличении общей площади на единичку,

104
00:08:31,280 --> 00:08:36,980
мы получаем другой более широкий
доверительный интервал от 2,37 до 2,18.

105
00:08:36,980 --> 00:08:39,902
Если мы сравним с тем
доверительным интервалом,

106
00:08:39,902 --> 00:08:44,089
который считается по умолчанию,
который является некорректным в условиях

107
00:08:44,089 --> 00:08:48,660
гетероскедастичности confint(model),

108
00:08:48,660 --> 00:08:56,060
то старый некорректный интервал
был уже — от 2,5 до 2,7.

109
00:08:56,060 --> 00:09:01,688
А здесь мы видим, что
гетероскедастичность чуть-чуть расширила

110
00:09:01,688 --> 00:09:06,960
доверительный интервал,
то есть сделала оценки менее точными.

