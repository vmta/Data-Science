1
00:00:08,230 --> 00:00:16,733
Теперь перейдем

2
00:00:16,733 --> 00:00:19,309
к формальным тестам на
гетероскедастичность.

3
00:00:19,309 --> 00:00:20,825
Начнем мы с теста Уайта или,

4
00:00:20,825 --> 00:00:25,420
по-другому, другую версию называют,
этого теста называют тест Бройша-Пагана.

5
00:00:25,420 --> 00:00:28,101
Вот мы применим bptest к модели.

6
00:00:28,101 --> 00:00:30,111
В чем состоит этот тест?

7
00:00:30,111 --> 00:00:34,739
Помимо оценки основной регрессии
оценивается вспомогательная регрессия,

8
00:00:34,739 --> 00:00:39,161
где квадраты остатков ε с крышкой в
квадрате проверяется их зависимость от тех

9
00:00:39,161 --> 00:00:42,396
же объясняющих переменных,
что и в исходной модели.

10
00:00:42,396 --> 00:00:47,253
То есть, здесь была построена регрессия
квадратов остатков ε с крышкой в квадрате

11
00:00:47,253 --> 00:00:52,148
на те же объясняющие переменные, то есть
на одну объясняющую переменную totsp,

12
00:00:52,148 --> 00:00:57,054
и оказалось, что гипотеза о том, что
зависимости во вспомогательной регрессии

13
00:00:57,054 --> 00:01:00,540
нет, эта гипотеза отвергается
в силу маленького p-value.

14
00:01:00,540 --> 00:01:04,016
То есть,
у нас имеет место гетероскедастичность,

15
00:01:04,016 --> 00:01:08,014
так как гипотеза об условной
гомоскедастичности была отвергнута.

16
00:01:08,014 --> 00:01:11,290
Чтобы провести все-таки
классический вариант теста Уайта,

17
00:01:11,290 --> 00:01:16,562
где во вспомогательной регрессии
включаются не только исходные регрессоры,

18
00:01:16,562 --> 00:01:20,702
но и их квадраты, попарные произведения,
надо это отдельно,

19
00:01:20,702 --> 00:01:25,489
специально указать r в команде bptest,
то есть надо взять данные из

20
00:01:25,489 --> 00:01:30,022
набора данных h и во вспомогательную
регрессию, здесь есть varformula,

21
00:01:30,022 --> 00:01:34,348
то есть формула для вспомогательной
регрессии, соответственно, здесь указать,

22
00:01:34,348 --> 00:01:38,941
что нас интересует зависимость не только
от исходного фактора общей площади,

23
00:01:38,941 --> 00:01:41,880
но также от и исходной площади в квадрате.

24
00:01:41,880 --> 00:01:45,173
И, соответственно,
если я дам такую команду,

25
00:01:45,173 --> 00:01:51,066
во вспомогательной регрессии окажется две
объясняющих переменных, соответственно,

26
00:01:51,066 --> 00:01:55,710
получится классическая формула статистики
Уайта, и тут опять гипотеза о том,

27
00:01:55,710 --> 00:01:58,955
что зависимости во вспомогательной
регрессии нет, отвергается,

28
00:01:58,955 --> 00:02:03,480
значит, имеет место условная
гетероскедастичность.

29
00:02:03,480 --> 00:02:05,536
И пару слов о синтаксисе.

30
00:02:05,536 --> 00:02:10,954
Вот здесь я, когда писал формулу,
написал какое-то I со скобками.

31
00:02:10,954 --> 00:02:15,844
Это означает, что вот эту степень
надо воспринимать r буквально,

32
00:02:15,844 --> 00:02:19,205
а не как специальную
команду внутри формулы.

33
00:02:19,205 --> 00:02:22,293
У r вообще богатый синтаксис, например,

34
00:02:22,293 --> 00:02:27,832
я мог тот же самый результат получить
с помощью другого описания формулы.

35
00:02:27,832 --> 00:02:29,396
Я, например, мог сказать,

36
00:02:29,396 --> 00:02:34,558
что нужен полином второй степени со
всеми коэффициентами от общей площади.

37
00:02:34,558 --> 00:02:38,910
Я мог написать poly(totsp),
указатель второй степени,

38
00:02:38,910 --> 00:02:42,990
и эта команда имеет абсолютно точно
такой же эффект, как предыдущая.

39
00:02:42,990 --> 00:02:47,927
То есть, в качестве регрессоров
берутся totsp в первой степени,

40
00:02:47,927 --> 00:02:51,830
totsp во второй степени и константа.

41
00:02:51,830 --> 00:02:55,681
Соответственно, результат
выходит совершенно аналогичный.

42
00:02:55,681 --> 00:02:59,820
И второй тест, который мы проведем
– это тест Голдфелда-Квандта.

43
00:02:59,820 --> 00:03:05,040
Соответственно, в чем,
как устроен тест Голдфелда-Квандта?

44
00:03:05,040 --> 00:03:09,600
Нам поможет команда gqtest.

45
00:03:09,600 --> 00:03:15,339
Мы берем нашу модель и здесь
для теста Голдфелда-Квандта уже

46
00:03:15,339 --> 00:03:20,795
надо указать некую переменную,
которая объясняет гетероскедастичность,

47
00:03:20,795 --> 00:03:25,153
то есть от которой условная дисперсия
ε i-того зависит монотонно.

48
00:03:25,153 --> 00:03:29,447
Ну, мы предполагаем, что разброс
цены связан с размером квартиры,

49
00:03:29,447 --> 00:03:34,716
то есть мы предполагаем,
что нам нужно будет сортировать

50
00:03:34,716 --> 00:03:39,012
по переменной (нам нужна будет опция

51
00:03:39,012 --> 00:03:43,877
order.by) сортировать по переменной totsp,

52
00:03:43,877 --> 00:03:48,777
данные мы возьмем из набора данных h,
и дальше надо указать,

53
00:03:48,777 --> 00:03:52,365
какой процент наблюдений
надо выкинуть посередине.

54
00:03:52,365 --> 00:03:56,017
Автоматически gqtest в R,
он возьмет верхнее наблюдение,

55
00:03:56,017 --> 00:03:58,441
нижнее наблюдение, серединку выкинет.

56
00:03:58,441 --> 00:04:03,787
Ну давайте, скажем, количество
наблюдений по середине, долю, возьмем,

57
00:04:03,787 --> 00:04:10,280
скажем, 20 % наблюдений посередине выкинем
и проведем тест Голдфелда-Квандта.

58
00:04:10,280 --> 00:04:15,485
Соответственно, тест Голдфелда-Квандта,
он оценит две вспомогательные регрессии.

59
00:04:15,485 --> 00:04:18,164
Поскольку я 20 % выкинул, значит,

60
00:04:18,164 --> 00:04:22,821
у меня осталось 40 % наблюдений,
где подозрительно большая дисперсия,

61
00:04:22,821 --> 00:04:27,428
40 % наблюдений, где подозрительно
маленькая дисперсия, и, соответственно,

62
00:04:27,428 --> 00:04:31,978
R оценит две модели: одну, там, где
дисперсия ожидается большой, другую, там,

63
00:04:31,978 --> 00:04:36,220
где дисперсия ожидается маленькой, поделит
RSS одной модели на RSS другой модели.

64
00:04:36,220 --> 00:04:41,657
Вот у него получилось в результате 8,2
при делении RSS той части выборки,

65
00:04:41,657 --> 00:04:44,698
где, предположительно,
высокая дисперсия, на ту часть,

66
00:04:44,698 --> 00:04:47,940
на RSS той части выборки,
где предположительно низкая дисперсия.

67
00:04:47,940 --> 00:04:52,970
И p-value оказалось снова очень маленьким,
меньше чем 2,2 * 10 в минус 16.

68
00:04:52,970 --> 00:04:56,537
Соответственно, вывод:
гипотеза h0 об условной

69
00:04:56,537 --> 00:05:01,097
гомоскедастичности также отвергается.

70
00:05:01,097 --> 00:05:03,355
Что мы можем сделать,

71
00:05:03,355 --> 00:05:07,640
какие меры помимо использования робастных
стандартных ошибок мы можем применять?

72
00:05:07,640 --> 00:05:12,038
Одним из частых преобразований
является логарифмирование данных.

73
00:05:12,038 --> 00:05:15,278
Если я посмотрю на исходный график,


74
00:05:15,278 --> 00:05:20,019
где гомоскедастичности явно нет,
и построю также зависимость цены

75
00:05:20,019 --> 00:05:24,470
квартиры также от общей площади,
но в логарифмах.

76
00:05:24,470 --> 00:05:28,730
Я построю qplot,
данные возьму из набора данных h,

77
00:05:28,730 --> 00:05:32,887
но по горизонтали я отложу
логарифм общей площади,

78
00:05:32,887 --> 00:05:37,741
а по вертикали я отложу
логарифм цены квартиры.

79
00:05:37,741 --> 00:05:43,559
В этих осях у меня уже зависимость
будет больше похожа на

80
00:05:43,559 --> 00:05:47,980
зависимость условной гомоскедастичности,
потому что вот, при логарифме, равном 5,

81
00:05:47,980 --> 00:05:54,040
разброс примерно уже похож на
разброс цен при логарифме, равном 4.

82
00:05:54,040 --> 00:05:59,265
И если я оценю, скажем,
модель 2, которая в точности

83
00:05:59,265 --> 00:06:04,490
будет дублировать модель 1, точно так
же данные берутся из набора данных h,

84
00:06:04,490 --> 00:06:11,340
но зависеть будет логарифм цены
от логарифма общей площади.

85
00:06:11,340 --> 00:06:17,022
Если я оценю модель 2 и посмотрю на,
скажем,

86
00:06:17,022 --> 00:06:22,520
тот же тест Голдфелда-Квандта,
только для модели 2.

87
00:06:22,520 --> 00:06:28,740
Здесь я исправлю 2,
а так команда совершенно аналогичная.

88
00:06:28,740 --> 00:06:32,046
И, соответственно,

89
00:06:32,046 --> 00:06:37,026
я дам команду на тест Голдфелда-Квандта,
то, несмотря, конечно,

90
00:06:37,026 --> 00:06:41,100
на то, что гетероскедастичность в
этой преобразованной модели осталась,

91
00:06:41,100 --> 00:06:44,884
она уже не так сильно выражена,
как в прошлый раз,

92
00:06:44,884 --> 00:06:48,523
потому что если посмотреть на
статистику Голдфелда-Квандта,

93
00:06:48,523 --> 00:06:53,474
то есть во сколько раз отличаются RSS
в части выборки с предположительно

94
00:06:53,474 --> 00:06:58,294
высокой дисперсией и в части выборки
с предположительно низкой дисперсией,

95
00:06:58,294 --> 00:07:02,894
то оказывается, сейчас они отличаются
всего в 2,5 раза, в то время как,

96
00:07:02,894 --> 00:07:06,890
когда мы делали модель без логарифмов,

97
00:07:06,890 --> 00:07:11,315
соответствующие RSS отличались в 8 раз,
то есть в какой-то мере

98
00:07:11,315 --> 00:07:15,800
нам удалось немножко побороться
с гетероскедастичностью помимо

99
00:07:15,800 --> 00:07:20,815
использования робастных
стандартных ошибок.

100
00:07:20,815 --> 00:07:24,562
И я хочу еще раз обратить внимание
на мой порядок действий: я

101
00:07:24,562 --> 00:07:29,181
сначала использовал робастные
стандартные ошибки, а потом, собственно,

102
00:07:29,181 --> 00:07:31,675
выяснял, есть ли
гетероскедастичность или нет.

103
00:07:31,675 --> 00:07:34,053
К сожалению,
очень распространена практика,

104
00:07:34,053 --> 00:07:36,487
когда исследователь сначала
проверяет гипотезу,

105
00:07:36,487 --> 00:07:39,136
есть гетероскедастичность или нет,
и, соответственно, узнав,

106
00:07:39,136 --> 00:07:44,277
что гетероскедастичность есть, тогда
используются робастные стандартные ошибки,

107
00:07:44,277 --> 00:07:48,283
а если гетероскедастичности
по тестам не обнаружено,

108
00:07:48,283 --> 00:07:50,996
используются обычные стандартные ошибки.

109
00:07:50,996 --> 00:07:54,937
Эта практика, к сожалению, неверная,
потому что двойное тестирование всегда

110
00:07:54,937 --> 00:07:59,595
приводит к неправильным
рассчитываемым по умолчанию

111
00:07:59,595 --> 00:08:04,272
уровням значимости, поэтому двойного
тестирования следует избегать.

112
00:08:04,272 --> 00:08:08,043
Как только у вас есть теоретические
основания ожидать гетероскедастичность,

113
00:08:08,043 --> 00:08:11,349
а у нас они есть, логично предположить,
что разброс цены квартиры связан с ее

114
00:08:11,349 --> 00:08:16,079
размером, то надо использовать робастные
стандартные ошибки даже до, собственно,

115
00:08:16,079 --> 00:08:24,940
тестирования гипотезы о том,
есть гетероскедастичность или нет.

