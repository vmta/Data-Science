1
00:00:13,450 --> 00:00:19,595
Теперь мы поработаем в R с данными RLMS,

2
00:00:19,595 --> 00:00:25,441
это Российский мониторинг экономического
состояния и здоровья населения.

3
00:00:25,441 --> 00:00:29,715
Проще всего найти его данные,
набрав в «Гугле» hse rlms.

4
00:00:29,715 --> 00:00:33,659
И первая ссылка, которая получится,

5
00:00:33,659 --> 00:00:38,642
— это ссылка на проводимый при участии
Высшей школы экономики, соответственно,

6
00:00:38,642 --> 00:00:42,360
Российский мониторинг экономического
положения и здоровья населения.

7
00:00:42,360 --> 00:00:45,450
Нам, во-первых,
потребуются сами данные его.

8
00:00:45,450 --> 00:00:49,523
Это исследование проводится ежегодно,

9
00:00:49,523 --> 00:00:52,373
каждый год проводится
очередная волна исследования.

10
00:00:52,373 --> 00:00:55,000
Например,
21-я волна — это 2012-й год.

11
00:00:55,000 --> 00:00:59,960
Соответственно, есть обследования
домохозяйств, то есть семей,

12
00:00:59,960 --> 00:01:02,832
и есть обследования отдельных индивидов.

13
00:01:02,832 --> 00:01:06,030
Давайте для примера
скачаем данные по индивидам.

14
00:01:06,030 --> 00:01:09,796
Если вы кликните, то после простой
регистрации, где надо там указать фамилию,

15
00:01:09,796 --> 00:01:13,509
имя, «имейл»,
вы сможете скачать набор данных.

16
00:01:13,509 --> 00:01:17,912
И кроме набора данных также
потребуется описание переменных,

17
00:01:17,912 --> 00:01:22,974
потому что в наборе данных около 10-ти
тысяч наблюдений и 1000 переменных

18
00:01:22,974 --> 00:01:27,904
— от расходов на картошку до владения
мобильным телефоном и холодильником, то,

19
00:01:27,904 --> 00:01:32,480
соответственно, описание переменных
обязательно понадобится.

20
00:01:32,480 --> 00:01:37,370
Вот я, соответственно, смотрю Волна 21
«Описание файла данных по индивидам».

21
00:01:37,370 --> 00:01:40,276
Если я кликну,
это такой здоровый .pdf-файл,

22
00:01:40,276 --> 00:01:43,330
и вот здесь описание
подробное каждой переменной.

23
00:01:43,330 --> 00:01:46,988
Если она дискретная, качественная
и принимает какой-то ограниченный

24
00:01:46,988 --> 00:01:51,669
список значений, значит, тут указан список
соответствующих кодов и их значений.

25
00:01:51,669 --> 00:01:56,360
Например, переменная qh5 
(Пол респондента): 1 — мужской, 2,

26
00:01:56,360 --> 00:01:59,456
соответственно, женский.

27
00:01:59,456 --> 00:02:03,811
Теперь перейдём к загрузке
данного набора данных в R.

28
00:02:03,811 --> 00:02:07,402
Соответственно, давайте для
удобства начнём с чистого листа.

29
00:02:07,402 --> 00:02:08,260
Выберем файл.

30
00:02:08,260 --> 00:02:12,000
File, new File, R Script.

31
00:02:12,000 --> 00:02:16,986
И, соответственно,
загрузим заготовку с активации всех

32
00:02:16,986 --> 00:02:21,500
пакетов: Open File, lab_02_before.R.

33
00:02:21,500 --> 00:02:27,578
Соответственно, здесь быстренько
загрузим все необходимые пакеты,

34
00:02:27,578 --> 00:02:31,580
то есть выделим весь текст и нажмём
Ctrl плюс Enter или Command плюс Enter.

35
00:02:31,580 --> 00:02:36,443
Соответственно, здесь я хочу обратить
внимание, что все пакеты устанавливаются с

36
00:02:36,443 --> 00:02:40,414
официального репозитория,
кроме пакета rlms.

37
00:02:40,414 --> 00:02:45,884
Пакет rlms, надо сказать,
что он устанавливается особенно.

38
00:02:45,884 --> 00:02:50,696
Если вы стандартным образом вот так
установить можете через Tools,

39
00:02:50,696 --> 00:02:56,266
Install Packages, пакет devtools,
то после этого вы можете написать,

40
00:02:56,266 --> 00:03:00,840
чтобы установить пакет rlms: 

41
00:03:00,840 --> 00:03:05,472
devtools::install_github и в кавычках

42
00:03:05,472 --> 00:03:10,460
набрать специальный репозиторий,
где находится пакет rlms.

43
00:03:10,460 --> 00:03:14,470
То есть если у меня команда
library("rlms") дала ошибку,

44
00:03:14,470 --> 00:03:17,881
то с помощью 
devtools::install_github("bdemeshev/rlms") 


45
00:03:17,881 --> 00:03:18,670
я могу его установить.

46
00:03:18,670 --> 00:03:25,670
Теперь перейдём собственно
к загрузке данных.

47
00:03:25,670 --> 00:03:31,604
Мы предполагаем, что скачанный файл
rlms находится в той же папке,

48
00:03:31,604 --> 00:03:33,960
что и lab_02_before.R.

49
00:03:33,960 --> 00:03:38,943
Если это предположение выполнено,
тогда мы можем установить рабочую

50
00:03:38,943 --> 00:03:43,530
папку: Session, Set Working Directory,
To Source File Location.

51
00:03:43,530 --> 00:03:48,383
Соответственно, мы укажем R,
что файлы надо загружать из той же папки,

52
00:03:48,383 --> 00:03:49,784
что и исходный файл.

53
00:03:49,784 --> 00:03:55,238
И, указав это, после этого мы можем
загрузить в набор данных h данные rlms:

54
00:03:55,238 --> 00:04:01,185
специальная команда read.rlms и
в кавычках указываем имя файла.

55
00:04:01,185 --> 00:04:05,080
Наш файл называется "r21i_os24a".

56
00:04:05,080 --> 00:04:07,820
Опять же я не набирал имя рукам,

57
00:04:07,820 --> 00:04:11,490
а нажал tab и выбрал
появляющийся вариант из списка.

58
00:04:11,490 --> 00:04:12,902
Нажимаем Ctrl+Enter.

59
00:04:12,902 --> 00:04:17,711
И тут придётся немножко подождать,
потому что формат данных SPSS не является

60
00:04:17,711 --> 00:04:21,170
«родным» для R,
поэтому он выполняет преобразование.

61
00:04:21,170 --> 00:04:28,174
Соответственно, после того
как данные загрузились...

62
00:04:28,174 --> 00:04:32,540
Во-первых, для ускорения работы мы их
можем сохранить в «родном» для R формате.

63
00:04:32,540 --> 00:04:38,200
То есть чтобы не ждать так долго
каждый раз, я могу, например,

64
00:04:38,200 --> 00:04:44,855
сохранить данные в формате Rds, saveRDS.

65
00:04:44,855 --> 00:04:49,942
Тут написать набор данных
h и тут написать то же

66
00:04:49,942 --> 00:04:55,592
самое название файла,
только поставить расширение Rds.

67
00:04:55,592 --> 00:05:00,494
Cоответственно, эта операция уже

68
00:05:00,494 --> 00:05:05,610
занимает меньше времени,
и чтение данных из формата

69
00:05:05,610 --> 00:05:10,320
Rds тоже занимает меньше времени,
чем из чужого, из формата SPSS.

70
00:05:10,320 --> 00:05:13,881
И, соответственно,
перейдём к анализу данных, простому,

71
00:05:13,881 --> 00:05:15,530
хотя бы на уровне графиков.

72
00:05:15,530 --> 00:05:20,494
Во-первых, надо сказать, что там
10 000 наблюдений и 1000 переменных.

73
00:05:20,494 --> 00:05:22,848
Вся тысяча переменных,
скорее всего, вам не нужна.

74
00:05:22,848 --> 00:05:26,407
Давайте, на примере,
мы отберём в набор данных h2,

75
00:05:26,407 --> 00:05:30,170
мы отберём некоторые переменные.

76
00:05:30,170 --> 00:05:35,270
Отберём, скажем,
из набора данных h переменные qm1,

77
00:05:35,270 --> 00:05:38,350
qm2 — это рост и вес,

78
00:05:38,350 --> 00:05:44,050
qh6 — это год рождения и qh5 — это пол.

79
00:05:44,050 --> 00:05:46,728
Откуда я взял эти сокращения?

80
00:05:46,728 --> 00:05:50,970
Из, соответственно,
pdf-фала с описанием данных.

81
00:05:50,970 --> 00:05:55,818
Соответственно, теперь
я могу посмотреть на

82
00:05:55,818 --> 00:06:00,396
мои переменные describe(h2).

83
00:06:00,396 --> 00:06:04,620
Давайте посмотрим на описание данных.

84
00:06:04,620 --> 00:06:08,570
Видно, что qm1 — это,
действительно, рост.

85
00:06:08,570 --> 00:06:14,160
Вот средний 66 килограммов,
qm2 — это рост, 160,

86
00:06:14,160 --> 00:06:20,120
qh6 — это, соответственно,
год рождения и qh5 — это пол.

87
00:06:20,120 --> 00:06:27,437
Соответственно, мы можем,
во-первых, переименовать переменные.

88
00:06:27,437 --> 00:06:30,330
Давайте, h3, rename.

89
00:06:30,330 --> 00:06:37,144
Переименуем из набора данных, скажем,

90
00:06:37,144 --> 00:06:44,360
ves=qm1, rost=qm2,

91
00:06:44,360 --> 00:06:49,980
соответственно, пол, sex=qh5,

92
00:06:49,980 --> 00:06:54,600
и год рождения, давайте,

93
00:06:54,600 --> 00:06:59,640
b_year=qh6.

94
00:06:59,640 --> 00:07:05,080
Соответственно, создали набор данных h3.

95
00:07:05,080 --> 00:07:09,573
Ну можно, например, перейти от переменной
«год рождения» к переменной «возраст».

96
00:07:09,573 --> 00:07:10,460
Как это сделать?

97
00:07:10,460 --> 00:07:14,745
Мы можем набор h3 поменять,
использовать команду mutate и

98
00:07:14,745 --> 00:07:19,360
создать переменную, которая равна vozrast.

99
00:07:19,360 --> 00:07:23,373
Соответственно, что такое vozrast?

100
00:07:23,373 --> 00:07:30,330
Это год опроса, 2012-й мы брали,
минус год рождения, переменная b_year.

101
00:07:30,330 --> 00:07:35,700
Соответственно, теперь если
посмотреть на наши переменные,

102
00:07:35,700 --> 00:07:38,768
у нас получается: переменная vozrast,

103
00:07:38,768 --> 00:07:43,420
— вот максимальный возраст в
нашем наборе данных 101 год,

104
00:07:43,420 --> 00:07:47,690
а средний возраст равен примерно 40 годам.

105
00:07:47,690 --> 00:07:50,505
Помимо отбора переменных,

106
00:07:50,505 --> 00:07:55,322
мы можем столкнуться с отбором наблюдений.

107
00:07:55,322 --> 00:08:00,457
Давайте посмотрим описание переменной пол,

108
00:08:00,457 --> 00:08:04,870
что это за переменная: summary(h3$sex).

109
00:08:04,870 --> 00:08:09,010
Соответственно, она принимает
два значения: мужской и женский.

110
00:08:09,010 --> 00:08:12,730
И мы можем, например,
построить выборку одних мужчин h4.

111
00:08:12,730 --> 00:08:16,592
Мы на этот раз отберём не переменные,
а отберём наблюдения.

112
00:08:16,592 --> 00:08:20,717
Мы будем использовать другую команду,
не select, а filter.

113
00:08:20,717 --> 00:08:26,169
Соответственно, используем команду
filter из набора данных h3,

114
00:08:26,169 --> 00:08:30,410
выбираем те переменные, где переменная

115
00:08:30,410 --> 00:08:35,010
sex=мужской.

116
00:08:35,010 --> 00:08:41,660
Соответственно, h4, вот если посмотреть
сюда наверх, можно обратить внимание,

117
00:08:41,660 --> 00:08:47,370
что из 17 090 наблюдений у нас оказались
отобранными 7 300 с хвостиком наблюдений.

118
00:08:47,370 --> 00:08:50,970
И, например,
мы можем построить какой-нибудь график.

119
00:08:50,970 --> 00:08:56,709
Например, мы можем по набору данных h4,
возьмём данные из набора данных h4,

120
00:08:56,709 --> 00:09:03,890
пишем data=h4, и отложим по горизонтали
рост мужчины, по вертикали вес мужчины.

121
00:09:03,890 --> 00:09:08,916
И, соответственно, получим вот такой вот
интересный график, который нам показывает,

122
00:09:08,916 --> 00:09:14,115
что сначала, когда человек растёт, у него
растут и рост, и вес, а потом, когда

123
00:09:14,115 --> 00:09:18,990
человек достигает определённого возраста,
уже рост и вес практически не меняются.

124
00:09:18,990 --> 00:09:25,576
И точно так же можно построить
какую-нибудь гистограмму: qplot(data=h4).

125
00:09:25,576 --> 00:09:30,146
И посмотреть на гистограмму
веса мужчин в России.

126
00:09:30,146 --> 00:09:35,811
Соответственно, поскольку
здесь в выборке есть и дети,

127
00:09:35,811 --> 00:09:41,155
и взрослые, мы не разделяли по возрасту,
то вот видно два «горба»,

128
00:09:41,155 --> 00:09:47,630
и вот видно, у взрослых средний
вес примерно где-то чуть больше,

129
00:09:47,630 --> 00:09:52,130
наверно, порядка 70 вот здесь,
80, может, килограммов.

