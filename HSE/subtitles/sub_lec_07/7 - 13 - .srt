1
00:00:13,080 --> 00:00:20,890
И еще один маленький графический
сюжет — это ROC кривая.

2
00:00:20,890 --> 00:00:26,210
Когда мы спрогнозировали вероятность,
у нас получились числа от 0 до 1.

3
00:00:26,210 --> 00:00:32,866
Но при этом, когда нас просят
сделать конкретный прогноз,

4
00:00:32,866 --> 00:00:38,180
так выживет человек или нет, то мы
можем установить любой порог отсечения.

5
00:00:38,180 --> 00:00:42,767
Мы не обязаны поступать по принципу: если
спрогнозируемая вероятность больше 0.5,

6
00:00:42,767 --> 00:00:47,492
то мы прогнозируем, что он выживет; если
спрогнозируемая вероятность меньше 0.5,

7
00:00:47,492 --> 00:00:48,450
то он погибнет.

8
00:00:48,450 --> 00:00:52,709
Мы можем установить любой порог отсечения,
скажем, сказать, что для тех пассажиров, у

9
00:00:52,709 --> 00:00:57,760
которых прогнозная вероятность больше 0.4,
мы будем прогнозировать таких выжившими.

10
00:00:57,760 --> 00:01:00,791
Порог прогнозирования мы выбираем сами.

11
00:01:00,791 --> 00:01:06,497
Естественно, выбор порога,
начиная с которого

12
00:01:06,497 --> 00:01:12,320
мы считаем людей выжившими,
он влияет на вероятность разных ошибок.

13
00:01:12,320 --> 00:01:17,740
Давайте посмотрим, что будет происходить,
если мы будем устанавливать разные пороги.

14
00:01:17,740 --> 00:01:22,535
Для начала спрогнозируем вероятности
не для выдуманного нами набора

15
00:01:22,535 --> 00:01:25,810
данных new data,
а для исходного набора данных t.

16
00:01:25,810 --> 00:01:30,713
Соответственно, прогнозы для
набора данных t, это predict,

17
00:01:30,713 --> 00:01:34,340
мы используем оцененную нами логит модель,

18
00:01:34,340 --> 00:01:38,988
на наборе данных t прогнозируем,

19
00:01:38,988 --> 00:01:43,960
и для надежности попросим, чтобы
компьютер выдал нам стандартные ошибки.

20
00:01:43,960 --> 00:01:48,258
Я напомню, что команда predict по
умолчанию прогнозирует значение скрытой

21
00:01:48,258 --> 00:01:53,026
переменной, и ее необходимо дополнительно…
применить к ней логистическую функцию

22
00:01:53,026 --> 00:01:56,300
распределения, чтобы получить
прогнозные вероятности.

23
00:01:56,300 --> 00:02:03,990
Соответственно, мы подкрепим
новые столбики к табличке t.

24
00:02:03,990 --> 00:02:08,130
cbind к табличке t подкрепляем
наши новые столбики.

25
00:02:08,130 --> 00:02:14,174
Теперь превращаем оцененные
значения скрытой переменной к...

26
00:02:14,174 --> 00:02:16,300
превращаем их в вероятности.

27
00:02:16,300 --> 00:02:21,757
t = mutate t и вероятность

28
00:02:21,757 --> 00:02:26,760
мы оцениваем как логистическую функцию
распределения plogis в точке fit.

29
00:02:26,760 --> 00:02:33,340
Соответственно, для наглядности
давайте посмотрим на начало таблички.

30
00:02:33,340 --> 00:02:37,720
select от t,

31
00:02:37,720 --> 00:02:41,570
выберем возраст,

32
00:02:41,570 --> 00:02:47,250
выжил ли по факту пассажир или нет,
и наши спрогнозированные вероятности.

33
00:02:47,250 --> 00:02:54,370
Вот у нас видно всю табличку.

34
00:02:54,370 --> 00:03:01,480
У кого-то вероятность не спрогнозирована,
потому что не хватает наблюдений.

35
00:03:01,480 --> 00:03:03,516
По остальным у нас есть возраст,

36
00:03:03,516 --> 00:03:08,716
фактическое значение переменной выжил/ не
выжил и спрогнозированная вероятность.

37
00:03:08,716 --> 00:03:11,661
Например, вот этот пассажир,
1300-й, он не выжил.

38
00:03:11,661 --> 00:03:14,450
Спрогнозированная вероятность
для него равна 0.1.

39
00:03:14,450 --> 00:03:16,803
1301-й — по факту он выжил.

40
00:03:16,803 --> 00:03:21,190
Спрогнозированная вероятность
для него была равна 0.67.

41
00:03:21,190 --> 00:03:26,302
Теперь на основании этих
данных мы переберем разные

42
00:03:26,302 --> 00:03:31,270
пороги отсечения и посмотрим,
как влияет порог отсечения

43
00:03:31,270 --> 00:03:35,780
на вероятность неправильной
классификации пассажира.

44
00:03:35,780 --> 00:03:43,404
Соответственно, мы построим
так называемую ROC кривую.

45
00:03:43,404 --> 00:03:45,860
Сначала соберем для нее данные.

46
00:03:45,860 --> 00:03:50,040
roc.data равняется roc кривая...

47
00:03:50,040 --> 00:03:53,780
Нам из таблички t нужна

48
00:03:53,780 --> 00:04:00,359
вероятность «выжить»

49
00:04:00,359 --> 00:04:06,490
и из таблички t нам нужны фактические
значения переменной survived.

50
00:04:06,490 --> 00:04:14,660
Теперь у нас получился
список из трех переменных.

51
00:04:14,660 --> 00:04:17,135
Давайте на него посмотрим.

52
00:04:17,135 --> 00:04:22,842
Здесь присутствует в этом списке три
переменных: cutoffs — это компьютер

53
00:04:22,842 --> 00:04:28,532
сам перебрал все возможные пороги
отсечения: 0,97; 0,955; 0,954.

54
00:04:28,532 --> 00:04:33,939
То есть это граница,
за которой мы признаем пассажира выжившим.

55
00:04:33,939 --> 00:04:39,236
fpr — это false positive rate — это,
соответственно,

56
00:04:39,236 --> 00:04:46,280
доля ошибочно классифицированных
не выживших пассажиров.

57
00:04:46,280 --> 00:04:51,190
И true positive rate (tpr) — это
доля верно классифицированных

58
00:04:51,190 --> 00:04:53,005
выживших пассажиров.

59
00:04:53,005 --> 00:04:57,820
Давайте посмотрим,
как выглядят эти показатели на графике.

60
00:04:57,820 --> 00:05:03,670
qplot, по горизонтали мы отложим

61
00:05:03,670 --> 00:05:09,422
roc.data переменную «порог» (cutoffs),

62
00:05:09,422 --> 00:05:15,418
а по вертикали отложим из этого
набора данных переменную,

63
00:05:15,418 --> 00:05:21,034
скажем, tpr и укажем тип графика

64
00:05:21,034 --> 00:05:25,680
— линия.

65
00:05:25,680 --> 00:05:29,840
Увеличим график.

66
00:05:29,840 --> 00:05:34,970
По горизонтали на графике отмечены
возможные пороги отсечения,

67
00:05:34,970 --> 00:05:39,080
а по вертикали отмечен показатель
tpr (true positive rate),

68
00:05:39,080 --> 00:05:43,190
то есть в нашем случае это доля верно
классифицированных выживших пассажиров.

69
00:05:43,190 --> 00:05:47,492
Соответственно, если я выбираю низкий
порог отсечения, например, 0.25,

70
00:05:47,492 --> 00:05:51,470
это означает, что я большое количество
пассажиров прогнозирую выжившими,

71
00:05:51,470 --> 00:05:55,406
потому что как только прогнозная
вероятность оказывается больше 0.25,

72
00:05:55,406 --> 00:05:56,650
я считаю, что он выжил.

73
00:05:56,650 --> 00:06:01,084
Соответственно, в таком случае доля
верно классифицированных выживших

74
00:06:01,084 --> 00:06:04,762
пассажиров оказывается
высокой — около 0.75.

75
00:06:04,762 --> 00:06:08,792
Однако если я выбираю
высокий порог отсечения,

76
00:06:08,792 --> 00:06:12,904
скажем, 0.75, то это означает,

77
00:06:12,904 --> 00:06:17,255
что я существенно реже буду
прогнозировать пассажира как выжившего,

78
00:06:17,255 --> 00:06:23,094
и поэтому доля верно классифицированных
выживших пассажиров будет ниже — 

79
00:06:23,094 --> 00:06:26,140
порядка 0.4, судя по графику.

80
00:06:26,140 --> 00:06:30,815
Аналогично поступим и посмотрим
на график: доля неверно

81
00:06:30,815 --> 00:06:34,110
классифицированных не выживших пассажиров.

82
00:06:34,110 --> 00:06:36,437
Для этого строим график.

83
00:06:36,437 --> 00:06:41,087
По горизонтали откладываем
по-прежнему пороги отсечения,

84
00:06:41,087 --> 00:06:43,850
а по вертикали fpr (false positive rate),

85
00:06:43,850 --> 00:06:47,340
то есть долю неверно классифицированных
не выживших пассажиров.

86
00:06:53,040 --> 00:06:58,740
Увеличиваем график и видим: по горизонтали
у нас возможные пороги отсечения,

87
00:06:58,740 --> 00:07:03,790
а по вертикали – доля неверно
классифицированных не выживших пассажиров.

88
00:07:03,790 --> 00:07:09,409
То есть если я выбираю очень маленький
порог отсечения, скажем,

89
00:07:09,409 --> 00:07:16,206
близко к нулю, то есть это означает, что
я всех пассажиров прогнозирую выжившими.

90
00:07:16,206 --> 00:07:20,789
При этом у меня доля неверно
классифицированных не выживших пассажиров

91
00:07:20,789 --> 00:07:24,270
будет достаточно высокой,
поскольку я всех прогнозирую выжившими.

92
00:07:24,270 --> 00:07:28,311
И очень часто строят сочетание
этих двух графиков на одном,

93
00:07:28,311 --> 00:07:31,650
который называется,
собственно, ROC кривой.

94
00:07:31,650 --> 00:07:36,301
Для этого по горизонтали
откладывают из нашего

95
00:07:36,301 --> 00:07:41,754
набора данных откладывают
fpr — false positive rate,

96
00:07:41,754 --> 00:07:46,930
а по вертикали откладывают,
соответственно, true positive rate.

97
00:07:46,930 --> 00:07:52,500
И укажем тип графика — линия.

98
00:07:59,015 --> 00:08:03,940
Соответственно, этот график
показывает дилемму выбора между верно

99
00:08:03,940 --> 00:08:07,237
классифицированными погибшими
пассажирами и

100
00:08:07,237 --> 00:08:11,094
верно классифицированными
выжившими пассажирами.

101
00:08:11,094 --> 00:08:17,412
Если я устанавливаю высокий порог
отсечения, то, соответственно,

102
00:08:17,412 --> 00:08:23,120
у меня будет низкая доля верно
классифицированных выживших пассажиров,

103
00:08:23,120 --> 00:08:27,010
но высокая доля верно классифицированных
не выживших пассажиров.

104
00:08:27,010 --> 00:08:32,123
И наоборот, если я устанавливаю
низкий порог отсечения,

105
00:08:32,123 --> 00:08:36,878
я всех пассажиров прогнозирую,
что они выживают, соответственно,

106
00:08:36,878 --> 00:08:41,952
доля верно угаданных выживших
пассажиров у меня близка к 1,

107
00:08:41,952 --> 00:08:46,400
но близка к 1 и доля неверно
угаданных не выживших пассажиров.

108
00:08:46,400 --> 00:08:50,937
На примере набора данных о пассажирах
«Титаника» мы с вами разобрали задачу

109
00:08:50,937 --> 00:08:54,594
оценки логит модели,
интерпретации коэффициентов,

110
00:08:54,594 --> 00:08:58,340
расчет предельных эффектов
и задачу прогнозирования.

111
00:08:58,340 --> 00:09:05,191
Нам повезло и мы не столкнулись, например,
с проблемой разделения набора данных,

112
00:09:05,191 --> 00:09:10,170
которая была упомянута в лекции.

